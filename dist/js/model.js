function makeid(){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;5>a;a++)e+=o.charAt(Math.floor(Math.random()*o.length));return e}var geoLocations=[],geoLocation=function(e){var o=this;o.name=ko.observable(e.name),o.selected=ko.observable(!1),o.createMarker=function(e,a,t){o.marker=new google.maps.Marker({position:{lat:e,lng:a},map:map,animation:google.maps.Animation.DROP,title:o.name(),marker_id:t})},o.isSelected=function(e){o.selected(!0)}},ViewModel=function(){var e=this;e.neighborhoodInput=ko.observable(""),e.places=ko.observableArray([]),e.infoWindow=new google.maps.InfoWindow,e.selectedLocation=ko.observable(""),e.selectedLocationName=ko.observable(""),e.selectedLocationCategory=ko.observable(""),e.selectedLocationImageUrl=ko.observable(""),e.selectedLocationRatingUrl=ko.observable(""),e.selectedLocationSnippetText=ko.observable(""),e.selectedLocationYelpUrl=ko.observable(""),e.selectedLocationAddress=ko.observable(""),e.yelpDataArray=ko.observableArray([]),e.categories=ko.observableArray([]),e.categoryArray=ko.observableArray([]),e.selectedCategories=ko.observableArray([]),e.yelpError=ko.observable(""),e.eventfulError=ko.observable(""),e.eventTitle=ko.observable(""),e.eventUrl=ko.observable(""),e.markerArray=ko.observableArray([]),e.myFirebaseRef=ko.observable(""),e.eventImageUrl=ko.observable(""),e.eventsList=ko.observableArray([]),e.shouldShowMessage=ko.observable(!1),e.shouldShowEventfulError=ko.observable(!1),e.setInfoWindowPosition=function(o){e.infoWindow.open(map,o)},e.filter=ko.observable(""),e.myFirebaseRef=new Firebase("https://glaring-heat-1861.firebaseio.com/"),e.myFirebaseRef.on("value",function(o){console.log(o.val()),geoLocations=o.val(),geoLocations.forEach(function(o){e.places.push(new geoLocation(o))})},function(e){alert(e.code+"My locations of interest could not be loaded. :( Please refresh the page and try again. If issue persists, please email me at: shamyleg@gmail.com")}),e.showInfoWindowOnClick=function(o){e.getInfoWindowContent(e.infoWindow,o.marker),e.infoWindow.open(map,o.marker)},e.getEventfulData=function(){var o="http://api.eventful.com/json/events/search",a={location:"Chicago",date:"This Week",within:10,units:"mi",app_key:"qFc3kDQ6G9kXThcX",callback:"cb"},t={url:o,data:a,dataType:"jsonp",success:function(o){var a=o.events.event;e.eventsList(a)},error:function(o){console.log(o),e.eventfulError("Sorry, Eventful was unable to load events near "+neighborhood.name+". Please refresh the page to try again."),e.shouldShowEventfulError(!0)}};$.ajax(t)},e.getEventfulData(),e.getYelpData=function(o){var a="https://api.yelp.com/v2/search",t={term:o.name(),location:neighborhood.name,limit:1,oauth_consumer_key:"6Chkx9mYhCssQqXHPxvNQQ",oauth_token:"XQRWzlGQFGOlualvBLVTpJYi6EtszzBV",oauth_nonce:makeid(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",callback:"cb"},n="-J7YlB_RuZ7mfk3lxM8n0c3nT1s",r="D7t2lRihVRUyZrGh2gMRZqFLlQ8",s=oauthSignature.generate("GET",a,t,n,r,{encodeSignature:!1});t.oauth_signature=s;var i={url:a,data:t,cache:!0,dataType:"jsonp",success:function(a){0==a.businesses.length&&(console.log("Boo"),this.error()),0!=a.businesses.length&&(o.createMarker(a.businesses[0].location.coordinate.latitude,a.businesses[0].location.coordinate.longitude,a.businesses[0].id),o.category=a.businesses[0].categories[0][0],e.categoryArray().push(o.category),e.yelpDataArray.push(a),e.initializeInfoWindow(e.infoWindow,o),e.markerArray().push(o.marker),-1==e.categories().indexOf(o.category)&&e.categories.push(o.category))},error:function(a){var t=e.places().indexOf(o);e.places().splice(t,1),e.yelpError("Sorry, Yelp has got nothin' on "+o.name()),e.shouldShowMessage(!0)}};$.ajax(i)},e.setInfoWindowContent=function(o){e.selectedLocation(o.businesses[0]),e.selectedLocationName(e.selectedLocation().name),e.selectedLocationCategory(e.selectedLocation().categories[0][0]),e.selectedLocationImageUrl(e.selectedLocation().image_url),e.selectedLocationRatingUrl(e.selectedLocation().rating_img_url),e.selectedLocationSnippetText(e.selectedLocation().snippet_text),e.selectedLocationYelpUrl(e.selectedLocation().url),e.selectedLocationAddress(e.selectedLocation().location.display_address[0]+", "+e.selectedLocation().location.display_address[1]+", "+e.selectedLocation().location.display_address[2])},e.getInfoWindowContent=function(o,a){for(var t=0;t<e.yelpDataArray().length;t++)if(a.marker_id==e.yelpDataArray()[t].businesses[0].id){e.setInfoWindowContent(e.yelpDataArray()[t]);var n=$("#infowindow-content").html();o.setContent(n)}},e.allMarkersSet=function(){return e.places().length==geoLocations.length?(e.places().forEach(function(e){return null==e.marker?!1:void 0}),!0):!1},e.initializeInfoWindow=function(o,a){a.marker.addListener("click",function(o,a){return function(){e.getInfoWindowContent(o,a),toggleBounce(a,e.markerArray()),o.setPosition(a.position),o.open(map,a)}}(e.infoWindow,a.marker)),o.addListener("closeclick",function(){null!==a.marker.getAnimation()&&a.marker.setAnimation(null)})},e.setMapContent=function(){e.places().length==geoLocations.length&&e.places().length>0&&e.places().forEach(function(o){e.getYelpData(o)})},e.showInfoWindowOnClick=function(o){e.getInfoWindowContent(e.infoWindow,o.marker),toggleBounce(o.marker,e.markerArray()),e.infoWindow.open(map,o.marker)},e.hideErrorMessage=function(){e.shouldShowMessage(!1)},e.hideEventfulErrorMessage=function(){e.shouldShowEventfulError(!1)},e.selectedCategories.subscribe(function(o){o.forEach(function(o){e.places().forEach(function(a){return o!=a.category&&-1==e.selectedCategories().indexOf(a.category)?(removeMarker(a.marker),!1):(null==a.marker.map&&(console.log(a.name()),a.marker.setMap(map)),!0)})}),e.selectedPlaces=ko.observableArray(e.places()),0==o.length&&e.places().forEach(function(e){e.marker.setMap(map)})},this),e.filterLocationList=ko.computed(function(){var o=e.filter().toLowerCase();return 0==e.yelpDataArray().length&&e.setMapContent(),e.categoryArray().length==e.places().length&&1==e.allMarkersSet()?ko.utils.arrayFilter(e.places(),function(a){var t=!1;if(e.selectedCategories().length>0){console.log(e.selectedCategories().length);for(var n=0;n<e.selectedCategories().length;n++)a.category==e.selectedCategories()[n]&&(t=!0,a.selected(!0));if(""===o&&!t)return!1}if(null!=a.category&&null!=a.marker){if(0==a.name().toLowerCase().indexOf(o)&&""!=o&&t)return a.marker.setMap(map),!0;if(""===o&&t)return a.marker.setMap(map),!0;if(0==a.name().toLowerCase().indexOf(o)&&0==e.selectedCategories().length)return a.marker.setMap(map),!0;removeMarker(a.marker)}return!1}):void 0},this),e.filteredCategories=ko.computed(function(){return ko.utils.arrayFilter(e.categories(),function(e){return!0})},this)};$(".submenu").on("click",function(e){e.stopPropagation()}),ko.applyBindings(new ViewModel);